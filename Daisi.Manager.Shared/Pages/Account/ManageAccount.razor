@page "/account/manage"
@page "/account/manage/{Page}"
@using Daisi.Manager.Shared.Services
<div class="row align-items-stretch">
    @if (UserRole >= UserRoles.Manager)
    {
        <div class="d-md-none mt-3 mb-3">
            <select class="form-control" @onchange=OnChangePage">
                <option value="@AccountPages.Profile">Your Profile</option>
                <option value="@AccountPages.General">Account Info</option>
                <option value="@AccountPages.Users">Users</option>
                <option value="@AccountPages.Apps">Apps</option>
                <option value="@AccountPages.Drive">Drive</option>
                <option value="@AccountPages.Hosts">Hosts</option>
                <option value="@AccountPages.Orcs">Orcs</option>
                <option value="@AccountPages.Networks">Networks</option>
                <option value="@AccountPages.Payouts">Payouts</option>
                <option value="@AccountPages.Subscriptions">Subscriptions</option>
                <option value="@AccountPages.Credits">Credits</option>
            </select>
        </div>
    }
    <div class="d-none d-md-block col-12 col-md-4 bg-dark-subtle border-end py-4 @(FormFactor.GetFormFactor() != "Mobile" ? "vh-100" : "")">
        <h2>Your Account</h2>
        <div class="list-group">
            <a href="/account/manage/profile" class="list-group-item @(CurrentPage == AccountPages.Profile ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-user me-2"></i> Your Profile
                </h4>
            </a>
            @if (UserRole >= UserRoles.Manager)
            {
                <a href="/account/manage/general" class="list-group-item @(CurrentPage == AccountPages.General ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-info-circle me-2"></i> Account Info
                    </h4>
                </a>
                @if (UserRole >= UserRoles.Owner)
                {
                    <a href="/account/manage/users" class="list-group-item @(CurrentPage == AccountPages.Users ? "active" : "") cursor-pointer">
                        <h4 class="mt-2">
                            <i class="fa-duotone fa-people me-2"></i> Users
                        </h4>
                    </a>
                }
                <a href="/account/manage/apps" class="list-group-item @(CurrentPage == AccountPages.Apps ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-code me-2"></i> Apps
                    </h4>
                </a>
                <a href="/account/manage/drive" class="list-group-item @(CurrentPage == AccountPages.Drive ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-hard-drive me-2"></i> Drive
                    </h4>
                </a>
                <a href="/hosts" class="list-group-item cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-computer me-2"></i> Hosts
                    </h4>
                </a>
                <a href="/account/manage/orcs" class="list-group-item @(CurrentPage == AccountPages.Orcs ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-chart-network me-2"></i> Orcs
                    </h4>
                </a>
                <a href="/account/manage/networks" class="list-group-item @(CurrentPage == AccountPages.Networks ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-network-wired me-2"></i> Networks
                    </h4>
                </a>
                <a href="/account/manage/subscriptions" class="list-group-item @(CurrentPage == AccountPages.Subscriptions ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-refresh me-2"></i> Subscriptions
                    </h4>
                </a>
                <a href="/account/manage/credits" class="list-group-item @(CurrentPage == AccountPages.Credits ? "active" : "") cursor-pointer">
                    <h4 class="mt-2">
                        <i class="fa-duotone fa-coins me-2"></i> Credits
                    </h4>
                </a>

            }

        </div>

    </div>

    <div class="col-12 col-md-8 mt-2 pt-md-4 px-md-4">
        @if (CurrentPage == AccountPages.General)
        {
            <Daisi.Manager.Shared.Pages.Account.GeneralComponents.AccountGeneralInformationComponent></Daisi.Manager.Shared.Pages.Account.GeneralComponents.AccountGeneralInformationComponent>
        }
        else if (CurrentPage == AccountPages.Users)
        {
            <Daisi.Manager.Shared.Pages.Account.UserComponents.AccountUsersComponent></Daisi.Manager.Shared.Pages.Account.UserComponents.AccountUsersComponent>
        }
        else if (CurrentPage == AccountPages.Apps)
        {
            <Daisi.Manager.Shared.Pages.Account.AppComponents.AccountAppsComponent></Daisi.Manager.Shared.Pages.Account.AppComponents.AccountAppsComponent>
        }
        else if (CurrentPage == AccountPages.Orcs)
        {
            <Daisi.Manager.Shared.Pages.Account.OrcComponents.AccountOrcsComponent></Daisi.Manager.Shared.Pages.Account.OrcComponents.AccountOrcsComponent>
        }
        else if (CurrentPage == AccountPages.Networks)
        {
            <Daisi.Manager.Shared.Pages.Account.NetworkComponents.AccountNetworksComponent></Daisi.Manager.Shared.Pages.Account.NetworkComponents.AccountNetworksComponent>
        }
        else if (CurrentPage == AccountPages.Profile)
        {
            <Daisi.Manager.Shared.Pages.Account.ProfileComponents.UserProfileComponent></Daisi.Manager.Shared.Pages.Account.ProfileComponents.UserProfileComponent>
        }
        else if (CurrentPage == AccountPages.Payouts)
        {
            <Daisi.Manager.Shared.Pages.Account.PayoutComponents.AccountPayoutsComponent></Daisi.Manager.Shared.Pages.Account.PayoutComponents.AccountPayoutsComponent>
        }
        else if (CurrentPage == AccountPages.Subscriptions)
        {
            <Daisi.Manager.Shared.Pages.Account.SubscriptionsComponents.AccountSubscriptionsComponent></Daisi.Manager.Shared.Pages.Account.SubscriptionsComponents.AccountSubscriptionsComponent>
        }
        else if (CurrentPage == AccountPages.Drive)
        {
            <Daisi.Manager.Shared.Pages.Account.DriveComponents.AccountDriveComponent></Daisi.Manager.Shared.Pages.Account.DriveComponents.AccountDriveComponent>
        }
        else if (CurrentPage == AccountPages.Credits)
        {
            <Daisi.Manager.Shared.Pages.Account.CreditComponents.AccountCreditsComponent></Daisi.Manager.Shared.Pages.Account.CreditComponents.AccountCreditsComponent>
        }


    </div>
</div>
@code {
    enum AccountPages
    {
        Profile,
        General,
        Users,
        Apps,
        Drive,
        Hosts,
        Orcs,
        Networks,
        Payouts,
        Subscriptions,
        Credits
    }

    [Parameter] public string? Page { get; set; }

    public UserRoles? UserRole { get; set; }
    AccountPages CurrentPage { get; set; }

    [Inject] public IFormFactor FormFactor { get; set; }
    [Inject] public AuthService AuthService { get; set; }
    [Inject] public NavigationManager NavigationManager { get; set; }

    protected async override Task OnInitializedAsync()
    {
        UserRole = await AuthService.GetUserRoleAsync();
    }

    protected override void OnParametersSet()
    {
        if (!string.IsNullOrEmpty(Page) && System.Enum.TryParse<AccountPages>(Page, ignoreCase: true, out var parsed))
            CurrentPage = parsed;
        else
            CurrentPage = AccountPages.Profile;
    }

    void OnChangePage(ChangeEventArgs e)
    {
        var page = e.Value is not null ? System.Enum.Parse<AccountPages>(e.Value.ToString()!) : AccountPages.Profile;
        NavigationManager.NavigateTo($"/account/manage/{page.ToString().ToLower()}");
    }

}
