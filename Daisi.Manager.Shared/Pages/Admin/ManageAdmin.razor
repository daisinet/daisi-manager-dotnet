@page "/admin"
@page "/admin/{Page}"
@using Daisi.Manager.Shared.Services
<div class="row align-items-stretch">
    <div class="d-md-none mt-3 mb-3">
        <select class="form-control" @onchange="OnChangePage">
            <option value="@AdminPages.Accounts">Accounts</option>
            <option value="@AdminPages.CreditAnomalies">Credit Anomalies</option>
            <option value="@AdminPages.MarketplaceReview">Marketplace Review</option>
            <option value="@AdminPages.Models">Models</option>
            <option value="@AdminPages.News">News</option>
            <option value="@AdminPages.Providers">Providers</option>
            <option value="@AdminPages.Releases">Releases</option>
        </select>
    </div>
    <div class="d-none d-md-block col-12 col-md-4 bg-dark-subtle border-end py-4 @(FormFactor.GetFormFactor() != "Mobile" ? "vh-100" : "")">
        <h2>Admin</h2>
        <div class="list-group">
            <a href="/admin/accounts" class="list-group-item @(CurrentPage == AdminPages.Accounts ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-users-gear me-2"></i> Accounts
                </h4>
            </a>
            <a href="/admin/creditanomalies" class="list-group-item @(CurrentPage == AdminPages.CreditAnomalies ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-shield-exclamation me-2"></i> Credit Anomalies
                </h4>
            </a>
            <a href="/admin/marketplacereview" class="list-group-item @(CurrentPage == AdminPages.MarketplaceReview ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-store me-2"></i> Marketplace Review
                </h4>
            </a>
            <a href="/admin/models" class="list-group-item @(CurrentPage == AdminPages.Models ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-microchip-ai me-2"></i> Models
                </h4>
            </a>
            <a href="/admin/news" class="list-group-item @(CurrentPage == AdminPages.News ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-newspaper me-2"></i> News
                </h4>
            </a>
            <a href="/admin/providers" class="list-group-item @(CurrentPage == AdminPages.Providers ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-crown me-2"></i> Providers
                </h4>
            </a>
            <a href="/admin/releases" class="list-group-item @(CurrentPage == AdminPages.Releases ? "active" : "") cursor-pointer">
                <h4 class="mt-2">
                    <i class="fa-duotone fa-rocket me-2"></i> Releases
                </h4>
            </a>
        </div>
    </div>

    <div class="col-12 col-md-8 mt-2 pt-md-4 px-md-4">
        @if (CurrentPage == AdminPages.Accounts)
        {
            <Daisi.Manager.Shared.Pages.Admin.AdminAccountsComponent />
        }
        else if (CurrentPage == AdminPages.CreditAnomalies)
        {
            <Daisi.Manager.Shared.Pages.Admin.CreditAnomalies />
        }
        else if (CurrentPage == AdminPages.MarketplaceReview)
        {
            <Daisi.Manager.Shared.Pages.Admin.MarketplaceReviewQueue />
        }
        else if (CurrentPage == AdminPages.Models)
        {
            <Daisi.Manager.Shared.Pages.Admin.AdminModelsComponent />
        }
        else if (CurrentPage == AdminPages.News)
        {
            <Daisi.Manager.Shared.Pages.Admin.AdminNewsComponent />
        }
        else if (CurrentPage == AdminPages.Providers)
        {
            <Daisi.Manager.Shared.Pages.Admin.AdminProvidersComponent />
        }
        else if (CurrentPage == AdminPages.Releases)
        {
            <Daisi.Manager.Shared.Pages.Account.ReleaseComponents.ReleasesTabsComponent />
        }
    </div>
</div>
@code {
    enum AdminPages
    {
        Accounts,
        CreditAnomalies,
        MarketplaceReview,
        Models,
        News,
        Providers,
        Releases
    }

    [Parameter] public string? Page { get; set; }

    AdminPages CurrentPage { get; set; } = AdminPages.Accounts;

    [Inject] public IFormFactor FormFactor { get; set; }
    [Inject] public AuthService AuthService { get; set; }
    [Inject] public NavigationManager NavigationManager { get; set; }

    protected async override Task OnInitializedAsync()
    {
        var userRole = await AuthService.GetUserRoleAsync();
        if (userRole is null || userRole < UserRoles.Admin)
        {
            NavigationManager.NavigateTo("/account/manage");
        }
    }

    protected override void OnParametersSet()
    {
        if (!string.IsNullOrEmpty(Page) && System.Enum.TryParse<AdminPages>(Page, ignoreCase: true, out var parsed))
            CurrentPage = parsed;
        else
            CurrentPage = AdminPages.Accounts;
    }

    void OnChangePage(ChangeEventArgs e)
    {
        var page = e.Value is not null ? System.Enum.Parse<AdminPages>(e.Value.ToString()!) : AdminPages.Accounts;
        NavigationManager.NavigateTo($"/admin/{page.ToString().ToLower()}");
    }
}
